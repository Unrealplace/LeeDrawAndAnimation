function setCookie(e,t){var a=new Date;a.setTime(a.getTime()+18e5),document.cookie=e+"="+t+";expires="+a.toGMTString()}function getCookie(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var a=getCookie(e);null!=a&&(document.cookie=e+"="+a+";expires="+t.toGMTString())}function setup_submit_header(){setup_post_header("提交失败,请刷新重试")}function setup_load_header(){setup_post_header("加载失败,请刷新重试")}function setup_post_header(e){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},eror:function(){return hide_progress_tip(),show_tip(e),!1}})}function show_login_tip(){show_tip("请登录先...")}function show_tip_with_time(e,t){$(".read-later-alert").text(e).show(),window.setTimeout(function(){$(".read-later-alert").hide()},t)}function show_progress_tip(e){$(".read-later-alert").text(e).show()}function hide_progress_tip(){$(".read-later-alert").hide()}function show_tip(e){show_tip_with_time(e,2e3)}function show_error_tip(e){show_tip_with_time(e,3e3)}function destroymodal(){$(".popup").html(""),$(".popup").hide()}function redirect_to_url(e){window.location=e}function request_unread_cnt(e){$.get("/notifications/unread?t="+e,function(e){e.success&&parseInt(e.cnt)>0&&$("#unread").html('<a href="/notifications" target="_blank"><span class="badge" style="background:#009461;">'+e.cnt+"</span></a>")})}function redirect_to_timeout(e,t){$("#pop_modal").modal("show"),window.setTimeout("redirect_to_url('"+e+"');",t)}function sleep(e,t){$("#spinner4").hide(),$(".no-sense").hide(),$(".alert").hide(),$(".modal-body").html("<h4>操作成功，正在跳转至首页...</h4>"),window.setTimeout(function(){window.location=e},t)}function stop_spinner(){try{$("#page-loading").hide()}catch(e){}}function show_spinner(){try{$("#page-loading").show()}catch(e){}}function show_time(e){var t=new Date(e),a=("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2);return a}function htmlEncode(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}function htmlDecode(e){var t=document.createElement("div");return t.innerHTML=e,t.innerHTML}function SetCookie(e,t,a){document.cookie=e+"="+escape(t)+";expires="+a}function getCookie(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var a=getCookie(e);null!=a&&(document.cookie=e+"="+a+";expires="+t.toGMTString())}function hashCode(e){var t,a,n=0;if(e.length==0)return n;for(t=0;t<e.length;t++)a=e.charCodeAt(t),n=(n<<5)-n+a,n&=n;return n}function trim(e){return e.replace(/^\s+|\s+$/g,"")}function validateURL(e){var t=new RegExp("^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*$");return t.test(e)}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function isInteger(e){return!isNaN(parseInt(e))&&isFinite(e)}function getURLParameter(e){return decodeURI((RegExp(e+"="+"(.+?)(&|$)").exec(location.search)||[,null])[1])}function handle_follow_site(e,t,a){var n="btn-success";$(e).click(function(){var e=$(this).attr("data_id"),i=$(this);$.ajax({url:"/sites/do_follow",type:"POST",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},data:{id:e},success:function(e){e.success?(i.hasClass(n)?i.text(t):i.text(a),i.toggleClass(n)):show_tip(e.error)}})})}function async_do_zan_article(){$("#my_zan").click(function(){var e=$(this).attr("data_id"),t=$(this);$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},error:function(){return!1}}),$.post("/articles/do_like2",{id:e},function(e){"1"==e?(show_tip("已赞"),t.addClass("liked")):"2"==e?show_login_tip():"0"==e&&(show_tip("已取消赞"),t.removeClass("liked"))})})}function resize_article_image(e,t){$(window).load(function(){$(e+" img").each(function(e,a){var n=$(a),i=n.width(),s=n.height();i>t&&(n.height(n.height()*t/i),n.width(t)),n.hasClass("alignCenter")||n.hasClass("alignLeft")||n.hasClass("alignLeft0")||(i>280||i>t||i>250&&s>300)&&n.css("display","block")})})}function reload_comments(e,t,a,n){$(".load-fail a").after("<img src='http://static2.tuicool.com/images/spinner.gif' id='spinner3'/>"),$("#spinner3").show(),load_comments(e,t,a,n)}function more_comments(e,t,a,n){$(".more-comments a").after("<img src='http://static2.tuicool.com/images/spinner.gif' id='spinner3'/>"),$("#spinner3").show(),load_comments(e,t,a,n)}function load_comments(e,t,a,n){$(".load-fail").hide();var i={lines:7,length:5,width:3,radius:4,corners:1,rotate:0,color:"#000",speed:1,trail:0,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"-3",left:"275"},s=document.getElementById("spinner2");if(new Spinner(i).spin(s),$.ajaxSetup({error:function(){return $("#spinner3").hide(),$("#spinner2").hide(),$(".comment-loading").hide(),!1}}),!t)var t=1;$("#spinner").show(),$(".load-fail").hide(),$.getJSON("/comments/"+e+".json?page="+t+"&last="+a,function(i){if(i.success){if($(".comments-area").show(),$(".load-fail").hide(),$(".comment_cnt").text(i.cnt),i.cnt==0)$("#spinner2").fadeOut(),location.href.indexOf("comments")>0&&setflash("alert alert-success","已经加载完啦",5e3),$("#spinner").hide();else{$(".comments-list").show(),$(".comments-header").show();var s=i.comments;s.length>0?($(".relay").show(),$.each(s,function(t,i){var s=i.content,r=$(".span8 h1").text();if(a=i.uts,i.type==1)var o="http://www.weibo.com/u/"+i.uid,c="";else{var o="/user/"+i.uid;if(-1==n)var c="| <a href='javascript:reply_not_login(\""+e+"\");'>回复</a>";else var c="| <a href='javascript:reply(\""+i.username+"\");'>回复</a>"}var l="<ul class='dropdown-menu'>                          <li>                            <a target='blank' href='http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=tsina&amp;url=http://www.tuicool.com/articles/"+e+"&amp;title=分享评论:"+s+" //"+r+"（分享自 @推酷网）'>新浪微博</a>                          </li>                          <li>                            <a target='blank' href='http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=tqq&amp;url=http://www.tuicool.com/articles/"+e+"&amp;title=分享评论:"+s+" //"+r+"（分享自 @tuicool）'>腾讯微博</a>                          </li>                          <li>                            <a target='blank' href='http://s.evernote.com/grclip?url=http://www.tuicool.com/articles/"+e+"&amp;title=分享评论:"+s+" //"+r+"（分享自 @推酷网）'>印象笔记</a>                          </li>                          <li>                            <a target='blank' href='http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=douban&amp;url=http://www.tuicool.com/articles/"+e+"&amp;title=分享评论:"+s+" //"+r+"（分享自 @推酷网）'>豆瓣</a>                          </li>                          <li>                            <a target='blank' href='http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=renren&amp;url=http://www.tuicool.com/articles/"+e+"&amp;title=分享评论:"+s+" //"+r+"（分享自 @推酷网）'>人人网</a>                          </li></ul>";-1==n?$(".comments-list").append("<div class='single' id='c-"+i.id+"'>                            <img class='img avatar' src='"+i.avatar+"' class='avatar'>                            <div class='comment-item' style='padding:0 0 0 5px;'>                              <div class='info'>"+"<a class='uname' href='"+o+"' target='_blank'>"+i.username+"</a>"+"<span class='timestamp'>"+i.timestamp+"</span>                              </div>                              <div class='body'>"+i.content+"</div>                              </div></div></div>"):i.uid==n?$(".comments-list").append("<div class='single' id='c-"+i.id+"'>                             <img class='img avatar' src='"+i.avatar+"' class='avatar'>                             <div class='comment-item' style='padding:0 0 0 5px;'>                               <div class='info mine'>"+"<a class='uname' href='"+o+"' target='_blank'>"+i.username+"</a>"+"<span class='timestamp'>"+i.timestamp+"</span>                                 <div class='reply dropdown'>                                  <a class='dropdown-toggle share' data-toggle='dropdown'>分享<b class='caret'></b></a>                                    "+c+l+"                                 </div>                               </div>                               <div class='body'>"+i.content+"</div>                              </div></div></div>"):$(".comments-list").append("<div class='single' id='c-"+i.id+"'>                            <img class='img avatar' src='"+i.avatar+"' class='avatar'>                            <div class='comment-item' style='padding:0 0 0 5px;'>                              <div class='info'>"+"<a class='uname' href='"+o+"' target='_blank'>"+i.username+"</a>"+"<span class='timestamp'>"+i.timestamp+"</span>                                <div class='reply dropdown'>                                  <a class='dropdown-toggle share' data-toggle='dropdown'>分享<b class='caret'></b></a>                                    "+c+l+"                                 </div>                               </div>                              <div class='body'>"+i.content+"</div>                              </div>                            </div></div>")}),first=!1):(location.href.indexOf("comments")>0&&(first||setflash("alert alert-success","已经加载完啦",5e3)),first=!1),i.more?($(".more-comments a").attr("href","javascript:more_comments('"+e+"',"+(t+1)+","+a+","+1+");"),$(".more-comments").show()):($(".more-comments").hide(),location.href.indexOf("comments")>0&&(first||setflash("alert alert-success","已经加载完啦",5e3))),$("#spinner3").hide(),$("#spinner2").hide(),$("#spinner").hide(),a=parseInt($(".single")[0].id.substring(2)),location.href.indexOf("comments")>0}t+=1,first=!1}else $("#spinner3").hide(),$("#spinner2").hide(),$(".comment-loading").hide()})}function setflash(e,t){$("#flash_container").hide(),$("#flash_container").attr("class",e),$("#flash_container").text(t),$("#flash_container").prepend("<a href='#'' class='close' data-dismiss='alert'>×</a>"),$("#flash_container").fadeIn("slow"),$(".loadmore").replaceWith($("#flash_container")).show()}function load_user_comments(type){$.ajaxSetup({error:function(){return $(".progress").hide(),$("#spinner").hide(),!1}}),$("#spinner").show(),$.getJSON("/comments.json?page="+page,function(data){if(data.success){$(".load-fail").hide();var comments=eval("("+data.comments+")");comments.length==0?($(".loadmore").hide(),first||setflash("alert alert-success","已经加载完啦",5e3),$("#flash_container").css("margin-left","120px"),$("#spinner").hide(),first=!1):(page>0&&$(".c-month").append("<div class='page-bar'>第"+page+"页</div>"),$(".loadmore").show(),1==type?$.each(comments,function(e,t){$(".cmt-list tbody").append("<tr id='tr-"+t.id+"'><td class='cid'>"+t.id+"</td><td class='uid'><a target='_blank' href='/user/"+t.uid+"'>"+t.uid+"/"+t.username+"</a></td><td>"+t.content+"<br /><a href='/articles/"+t.aid+"/comments#c-"+t.id+"' target='_blank'>"+t.article_title+"</a></td><td>"+t.timestamp+"</td><td><a href='javascript:delcomment("+t.id+',"'+auth+"\");'>删除</a></td></tr>"),$("#spinner").hide()}):2==type&&$.each(comments,function(e,t){premonth==parseInt(t.month)&&preyear==parseInt(t.year)?($(".c-month").append("<div class='s-single'><div class='desc'>"+t.day+"日,评论了<a href='/articles/"+t.aid+"' target='_blank'>"+t.article_title+"</a><div class='c-short'>"+t.content+"</div><div class='date_tip'>"+t.timestamp+"</div></div></div>"),premonth=parseInt(t.month),preyear=parseInt(t.year)):($(".c-month").append("<div class='s-single'><div class='c-cal' style='background:"+randomcolor()+"'><div class='year'>"+t.year+"</div><div class='month'>"+t.month+"月</div></div><div class='desc'>"+t.day+"日,评论了<a href='/articles/"+t.aid+"' target='_blank'>"+t.article_title+"</a><div class='c-short'>"+t.content+"</div><div class='date_tip'>"+t.timestamp+"</div></div></div>"),premonth=parseInt(t.month),preyear=parseInt(t.year)),$("#spinner").hide(),data.more?(first||setflash("alert alert-success","已经加载完啦",5e3),$("#flash_container").css("margin-left","120px")):$(".loadmore").hide()})),first=!1,$(".progress").hide(),page+=1}else $(".load-fail").hide()})}function reload_user_comments(e){$(".load-fail").append($("#spinner")),load_user_comments(auth,e)}function delcomment(e,t){var a=confirm("确定要删除?");1==a&&$.getJSON(cmt_url+"/api/comments/del/"+e+"?auth="+t,function(e){e.success?$("#tr-"+e.cid).fadeOut():setflash("alert",e.error,5e3)})}function randomcolor(){return random=Math.round(Math.random()*10),["orange","lightblue","#69c","#9c9","#9cc","#699","#39c","#69f","pink","purple"][random]}function reply(e){$("#comment-body").focus().val("@"+e+" "),location="#comment-body"}function reply_not_login(e){$("#login-form").append('<input type="hidden" name="return_to" value="/articles/'+e+'"/>'),show_login_tip()}function get_weibo_async(e){$("#article_weibo .related-weibo-list").load("/articles/primary_weibo/"+e,function(e,t,a){if(a.status!=200||e.length<20)return $("#article_weibo").empty(),void 0;var n=parseInt($("#weibo-count").val());n>=1&&($("#weibo_num").text(n),$("#article_weibo").show())})}function replace_like_link_to_liked(){var e=new Array;$(".single_fake").each(function(){e.push($(this).attr("data-id"))}),$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},error:function(){return $(".progress").hide(),$("#spinner").hide(),!1}})}function SetCwinHeight(){var e=$("iframe").contents().find("meta").attr("content");$("iframe").height(e)}function load_5_comments(e){var t={lines:7,length:5,width:3,radius:4,corners:1,rotate:0,color:"#fff",speed:1,trail:0,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"-5",left:"110"},a=document.getElementById("spinner2");new Spinner(t).spin(a),$.ajaxSetup({error:function(e,t,a){return $(".progress").hide(),$("#spinner").hide(),alert(e.status),alert("Error Message: "+t),alert("HTTP Error: "+a),!1}}),$.getJSON("/comments/"+e+".json",function(e){e.success?($("#spinner2").hide(),e.comments.length==0?$("#comments-list").append("还没有评论该快评论吧"):(e.cnt>5&&$(".more").show(),$.each(e.comments,function(e,t){$("#comments-list").append("<div class='comment-item' >              <img class='img avatar' src='"+t.avatar+"' class='avatar'>              <div class='body'>"+t.content+"</div>            </div>")}))):$("#comments-list").append("加载失败")})}function read_later(e){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},error:function(){return $(".progress").hide(),$("#spinner").hide(),!1}}),$.post("/articles/mark_read_late",{article_id:e},function(e){e.code==1?(window.read_late_count+=1,$(".read-later-alert").show(0).delay(3e3).hide(0)):e.code==-1&&show_login_tip()},"json")}function read(e){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},error:function(){return $(".progress").hide(),$("#spinner").hide(),!1}}),$.post("/articles/read",{article_id:e},function(t){t.code==1&&($(".single_fake[data-id='"+e+"']").remove(),$(".read-later-alert").html("标记为已阅读").show(0).delay(2e3).hide(0))},"json")}function loada_page(e){$("#spinner2").show(),pn=$(".loada").attr("data-pn");var t=window.nav_action;last_id=$(".single_fake:last-child").attr("data-id"),lang_st=getURLParameter("lang");var a=t+e+"/"+pn+".json?last="+last_id;null!=lang_st&&(a=a+"&lang="+lang_st),$.get(a,function(e){e.success?($.each(e.data,function(e,t){var a,n,i='<span class="cut cut28"><i class="icon-file icon"></i> '+t.feed_title+"</span>",s='<span class="date_tip"><i class="icon-time icon"></i> '+show_time(t.rect)+"</span>",r="<a href=\"javascript:read_later('"+t.id+'\');" class="read-later-btn pull-right"><i class="icon-bookmark"></i>稍后阅读</a>';if(a=window.show_state?t.st==1?'<i class="article-list-ico article-list-recommand">荐</i>':t.st==2?'<i class="article-list-ico article-list-hot">热</i>':"":"",window.style==0)n='<li class="single_fake"><div class="list_a_item2"><div class="title">'+a+'<a href="/articles/'+t.id+'" target="_blank" title="'+t.t+'">'+t.t+'</a><span class="feed_title">('+t.feed_title+")</span>"+'<span class="date">'+show_time(t.rect)+"</span></div></div></li>";else{a+='<a href="/articles/'+t.id+'" class="article-list-title" target="_blank" title="'+t.t+'">'+t.t+"</a>";var o="";trim(t.img).length>5&&(o="<div class=\"article_thumb\"><img width='160' height='100' src='"+get_article_img(t.img)+"'></div>"),n=o.length==0?'<div class="single_fake" data-id="'+t.id+'"><div class="single"><div class="article_title abs-title">'+a+'</div><div class="article_cut">'+t.abs+"</div>"+o+'<div class="clear"></div></div>'+'<div class="tip meta-tip">'+i+s+r+'<div class="clear"></div></div></div>':'<div class="single_fake" data-id="'+t.id+'"><div class="single"><div class="single_left"><div class="article_title abs-title">'+a+'</div><div class="article_cut">'+t.abs+"</div></div>"+o+'<div class="clear"></div></div>'+'<div class="tip meta-tip">'+i+s+r+'<div class="clear"></div></div></div>'}$("#list_article").append(n)}),e.has_next==1?(pn=parseInt(pn)+1,$(".loada").attr("data-pn",pn)):$(".loada").hide()):($(".read-later-alert").text("加载失败，请刷新重试").show(),window.setTimeout(function(){$(".read-later-alert").hide()},5e3)),$("#spinner2").hide()})}function get_article_img(e){return number=hashCode(e),n=Math.abs(number)%2,"http://aimg"+n+".tuicool.com/"+e}function load_home_info(){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}),$.getJSON("/home/check_info.json",function(e){e.success&&e.periods.length>0&&($.each(e.periods,function(e,t){var a="<div class='period-item'><a href='"+t.url+"' target='_blank' class='core_color'>"+t.title+"</a><span class='pull-right'>"+t.time+"</span></div>";$("#period-container").append(a)}),$("#period-container").show())})}function add_article_to_kan(e,t){setup_submit_header(),$("#new-kan").modal("hide"),show_progress_tip("正在保存中...."),$.post("/kans/like.json",{kan_id:t,article_id:e},function(e){hide_progress_tip(),e.success?(show_tip("已收藏到推刊"),$("#my_fav").html('<i class="icon icon-star"></i><span id="fav_tip">已收藏</span>')):show_error_tip(e.message)},"json")}function open_add_article_to_kan(e){var t="icon-star";$("#my_fav").click(function(){if("false"==e)return show_login_tip(),void 0;var a=$(this).attr("data_id"),n=$(this);$("#my_fav i").hasClass(t)?($("#fav_tip").text("请稍等"),setup_submit_header(),$.post("/articles/un_fav",{id:a},function(e){"2"==e?show_login_tip():"0"==e&&n.html('<i class="icon icon-star-empty"></i><span id="fav_tip">收藏</span>')})):load_my_kans()})}function create_kan(){var e=$("#new-kan-name").val(),t=$("#new-kan textarea").val(),a=$("#new-kan :radio:checked").val();setup_submit_header(),show_progress_tip("创建中....."),$.post("/kans.json",{name:e,desc:t,type:a},function(e){hide_progress_tip(),e.success?(self.location.pathname=="/kans"?$("#my-kan-list").prepend('<li class="kan-item"><a href="/kans/'+e.kan.id+'"><img src="'+e.kan.img+'" /></a>          <span><a href="/kans/'+e.kan.id+'">《'+e.kan.n+"》</a></span><li>"):($("#add-kan-list li").removeClass("active-li"),$("#add-kan-list").prepend('<li data-id="'+e.kan.id+'" class="active-li">'+e.kan.n+"</li>")),$("#new-kan").modal("hide"),show_tip("创建成功"),load_my_kans()):show_error_tip(e.message)},"json")}function load_my_kans(){setup_load_header(),show_progress_tip("推刊列表加载中..."),$.getJSON("/kans/my.json",function(e){if(hide_progress_tip(),e.success){$("#add-article-to-kan").modal("show"),$("#add-kan-list").empty(),$("#add-kan-list").append('<li class="active-li" data-id="'+e.kans[0].id+'">'+e.kans[0].n+"</li>");for(var t=1;t<e.kans.length;t++)$("#add-kan-list").append('<li data-id="'+e.kans[t].id+'">'+e.kans[t].n+"</li>")}else show_error_tip("加载失败,请刷新重试")})}function update_kan(){var e=$("#edit-kan-id").val(),t=$("#new-kan-name").val(),a=$("#desc").val(),n=$("#new-kan :radio:checked").val();setup_submit_header(),show_progress_tip("修改中....."),$.post("/kans/"+e+".json",{kan:{n:t,desc:a,t:n},_method:"PUT"},function(e){hide_progress_tip(),e.success?($(".kan-name").html("《"+e.kan.n+"》"),$(".header-title span").html(e.kan.n),$(".kan-desc").html("描述:"+e.kan.desc),show_tip("修改成功"),$("#new-kan").modal("hide")):show_error_tip(e.message)},"json")}function migrate_kan(){var e=$("#edit-kan-id").val(),t=$("#add-kan-list .active-li").attr("data-id");return e==t?(show_tip("不能迁移到自己"),void 0):(setup_submit_header(),$.post("/kans/migrate.json",{target_id:t,id:e,_method:"DELETE"},function(e){e.success?(show_tip("迁移成功"),self.location="/kans/"):show_error_tip(e.message)},"json"),void 0)}function subscribe_kan(e){setup_submit_header(),show_progress_tip("提交中..."),$.post("/kans/subscribe.json",{iid:e},function(t){hide_progress_tip(),t.success?(show_tip("已订阅"),$(".j").empty(),$(".j").append('<a href="javascript:unsubscribe_kan('+e+');" class="btn pull-right subs-kan" style="margin-right:10px;">已订阅</a>')):show_error_tip(t.message)},"json")}function unsubscribe_kan(e){setup_submit_header(),show_progress_tip("提交中..."),$.post("/kans/unsubscribe.json",{iid:e,_method:"DELETE"},function(t){t.success?(show_tip("已取消订阅"),$(".j").empty(),$(".j").append('<a href="javascript:subscribe_kan('+e+')" class="btn pull-right btn-success subs-kan" style="margin-right:10px;">订阅</a>')):show_error_tip(t.message)},"json")}function check_kan_desc(){var e=!0,t=$(".modal-body #desc").val();return t.length>100&&($(".new-ness-desc").css("display","block"),e=!1),e}function related_kan(id){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},error:function(){return!1}}),$.getJSON("/kans/related_kan/"+id+".json",function(data){if(data.success){var head=" <div class='article-part-title'> <span>相关推刊</span></div>",html="<ul class='kan-list'>",end="</ul>",clear="<i class='clearfix'></i>";kans=eval(data.kans),$.each(kans,function(e,t){html+=t.type==1?"          <li class='kan-item'>            <a href='/kans/"+t.id+"' target='_blank' class='kan-item-head'>              <small>"+t.owner+"</small>              <img class='kan-cover' src='"+t.img+"'/>            </a>            <span class='kan-detail'>              <a href='/kans/"+t.id+"' target='_blank'>《"+t.n+"》</a>              <i class='kan-num'>"+t.ac+"</i>            </span>          </li>        ":"          <li class='kan-item'>            <span class='kan-item-head'>              <small>"+t.owner+"</small>              <img class='kan-cover' src='"+t.img+"'/>            </span>            <span class='kan-detail'>              <i>《"+t.n+"》</i>              <i class='kan-num'>"+t.ac+"</i>            </span>          </li>        "}),$("#kan_articles").html(head+html+end+clear)}})}$(document).ready(function(){$(document).on("mouseover",".single",function(){var e=$(this).children(".comment-item").children(".info");$(".reply",e).show()}),$(document).on("mouseout",".single",function(){var e=$(this).children(".comment-item").children(".info");$(".reply",e).hide()}),$("#article-correct").click(function(){var e=$(this).attr("uid");e.length>4?$("#article-correct-modal").modal():show_login_tip()}),$("#article-correct-submit").click(function(){var e=$("#article-correct-source").val(),t=$("#article-correct-email").val(),a=$("#article-correct-select").val()+"     附加："+$("#article-correct-other").val();$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},error:function(){return!1}}),$.post("/articles/correct",{source:e,email:t,content:a},function(e){e.success?($("#article-correct-modal").modal("hide"),$(".read-later-alert").text("感谢你提供信息,我们会尽快处理.").show(),window.setTimeout(function(){$(".read-later-alert").hide()},3e3),$("#article-correct-other").val("")):($("#article-correct-modal  .alert").remove(),$("#article-correct-modal .modal-body").prepend("<div class='alert alert-important'>填写有问题,请重新填写.</div>"))})})}),$(document).ready(function(){var e=$(".subnav").attr("data-category");$(".subnav a[href='/"+e+"']").addClass("active"),"new"==e&&$(".subnav a[href='/advice']").addClass("active")}),$(document).ready(function(){$("#new-kan-name").mouseout(function(){$(this).val()==""?($(".new-ness-name").html("请输入推刊名"),$(".new-ness-name").css("display","block"),$(".create-kan-btn").attr("disabled","disabled")):$(this).val().length>20?($(".new-ness-name").html("推刊名要小于20个字符").css("display","block"),$(".create-kan-btn").attr("disabled","disabled")):($(".new-ness-name").hide(),$(".create-kan-btn").removeAttr("disabled"),$(".edit-kan-btn").removeAttr("disabled"))}),$(".modal-body #desc").mouseout(function(){check_kan_desc()?($(".edit-kan-btn").removeAttr("disabled"),$(".create-kan-btn").removeAttr("disabled"),$(".new-ness-desc").hide()):($(".create-kan-btn").attr("disabled","disabled"),$(".edit-kan-btn").attr("disabled","disabled"))}),$("#add-kan-list li:first-child").addClass("active-li"),$(document).on("click","#add-kan-list > li",function(){$("#add-kan-list > li").removeClass("active-li"),$(this).addClass("active-li")}),$(".create-kan-btn").click(function(){check_kan_desc()&&create_kan()}),$(".edit-kan-btn").click(function(){check_kan_desc()&&update_kan()}),$(".destroy-kan").click(function(){load_my_kans();var e=$(this).attr("data-id");$('#add-kan-list li[data-id="'+e+'"]').remove()}),$(".remove-kan-btn").click(function(){$("#remove-kan :radio:checked").val()==1?$("#add-kan-list li").size()>=2?$("#remove-kan-alert").modal("show"):show_tip("必须保留一个推刊!"):$("#add-kan-list li").size()>=2?migrate_kan():show_tip("必须保留一个推刊!")}),$(".add-to-btn").click(function(){var e=$(".article-id").val(),t=$(".active-li").attr("data-id");add_article_to_kan(e,t),$("#add-article-to-kan").modal("hide")}),$("a[href='#new-kan']").click(function(){$("#add-article-to-kan").modal("hide")}),$(".dismiss-new-kan").click(function(){load_my_kans()}),$(".kan-cover").mouseover(function(){$(".upload-kan-cover-btn").show()}),$(".upload-kan-cover-btn").mouseout(function(){$(this).hide()}),$(".upload-kan-cover-btn").click(function(){$("#upload-kan-cover").modal("show")})}),$(document).ready(function(){$(".popover-alert").mouseover(function(){$(this).popover("show")}),window.location.pathname.toString().indexOf("/admin/")>-1&&$("a").css("color","#009461")});